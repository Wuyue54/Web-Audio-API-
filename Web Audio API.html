<!DOCTYPE html>
<html>
  <head>
  
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Wuyue54.github.io by Wuyue54</title>
 
  <style>
    
    body {
    background: black;
    }

    button {
    cursor: pointer;
    border: none;
    border-radius: 10px;
    width: 120px;
    height: 50px;
    font-family: fantasy;
    font-size: 20px;
    font-weight: bold;
    margin: 25px auto;
    -webkit-transition: all .25s ease-in-out;
    transition: all .25s ease-in-out;
    display: block;
    
    }

    button:hover {
    background: orange;
    }

    #stopMusic, #playMusic {
    display: none;
    }

    #Canvas {
    margin: 5px;
    width: 600px;
    height: 600px;
    position:absolute;
    top:10%;
    left:30%;
    background:white;
    }

 </style>
</head>
  <body>
    
    <canvas id="Canvas"></canvas>  
    <button id="playMusic" type="button" value="1">Play</button>
    <button id="stopMusic" type="button" value="2">Stop</button>


   
  </body>

<script type="text/javascript">
window.requestAnimationFrame || (window.requestAnimationFrame =
  window.webkitRequestAnimationFrame ||
  window.mozRequestAnimationFrame    ||
  window.oRequestAnimationFrame      ||
  window.msRequestAnimationFrame     ||
  function(callback, element) {
    return window.setTimeout(function() {
      callback(+new Date());
  }, 1000 / 60);
});




var audio = {
  buffer: {}, 
  file: "http://s.cdpn.io/1715/the_xx_-_intro.mp3",
  proceed: true,
  playing: false,
  source: {}
};


try {
  window.AudioContext = window.AudioContext || window.webkitAudioContext || window.mozAudioContext || window.msAudioContext;
  audio.context = new window.AudioContext();
  audio.analyser = audio.context.createAnalyser();
  audio.analyser.fftSize = 256;
  document.getElementById('playMusic').style.display = "block";
} catch(e) {
  audio.proceed = false;
  document.getElementById('playMusic').style.display = "none"; 
  alert('Your browser does not support WEB AUDIO API');
}

if (audio.proceed) {
  
  (function() {
    var buffer = audio.context.createBufferSource();
  
  })();

  (function() {
    var req = new XMLHttpRequest();
    req.open('GET', audio.file, true);
    req.responseType = 'arraybuffer';
    req.onload = function() {
      audio.context.decodeAudioData(
        req.response,
        function(buffer) {
          audio.buffer = buffer;
          audio.source = {};
        },
        function() {
          alert('Error decoding audio "' + audio.file + '".');
        }
      );
    };
    req.send();
  })();
}


audio.play = function() {
  audio.playing = true;
  audio.source = audio.context.createBufferSource();
  audio.source.buffer = audio.buffer;
  //audio.source.connect(audio.context.destination);

  audio.source.connect(audio.analyser);
  audio.analyser.connect(audio.context.destination);
  
  audio.source.start(0);
};

audio.stop = function() {
  audio.source.stop(0);
  audio.playing = false;
  audio.source._startTime = audio.source.currentTime;
};

var playButton = document.getElementById('playMusic');
playButton.addEventListener('click', function(e) {
  stopButton.style.display = "block";
  playButton.style.display = "none";
  e.preventDefault();
  audio.play();
});

var stopButton = document.getElementById('stopMusic');
stopButton.addEventListener('click', function(e) {
  stopButton.style.display = "none";
  playButton.style.display = "block";
  e.preventDefault();
  audio.stop();
});


window.onload=function(){
var  canvas=document.getElementById('Canvas'),
		context=canvas.getContext('2d');

  var width=canvas.width,
    height=canvas.height;

  function Particle(){
 // this.x=Math.random() * width/2;
 // this.y=Math.random() * height/2;
  this.x= width/2;
  this.y= height/2;
 // this.vx=Math.random()*10-5;
 // this.vy=Math.random()*10-5;
  this.alpha=Math.random()*255;
  this.color=COLORS[parseInt(Math.random()*11)];
  this.life=Math.random()*20;
 // this.size=Math.random()*10;
   this.size=3;
  this.reset= function(){
    //this.x=Math.random() * width/2;
  	//this.y=Math.random() * height/2;
        this.x= width/2;
        this.y= height/2;
  	//this.vx=Math.random()*10-5;
  	//this.vy=Math.random()*10-5;
  	this.alpha=Math.random()*255;
  	this.color=COLORS[parseInt(Math.random()*11)];
  //	this.size=Math.random()*10;
    this.size=3;
    this.life=Math.random()*20;
  }
}

var num=1;
var P=[];

 
var COLORS = ['#69D2E7', '#1B676B', '#BEF202', '#EBE54D', '#00CDAC', '#1693A5', '#F9D423', '#FF4E50', '#E7204E', '#0CCABA', '#FF006F'];

for(var i=0;i<num;i++){
  P.push(new Particle);
}
 
  function draw(){
 // context.fillStyle = 'rgba(250, 250, 250, 0.75)';
// context.fillRect(0, 0, width, height);
 for(j=0;j<P.length;j++){
   var par=P[j];
   var value=VALUE;
    context.beginPath();
    context.fillStyle = par.color;
   context.strokeStyle=par.color;
   // context.fillRect(par.x,par.y,par.size,par.size);
   context.arc(par.x,par.y,par.size*value,0,2*Math.PI);
   context.fill();
   
   
 //  par.vx=Math.random()*4-2;
 //  par.vy=Math.random()*1;
   
//   par.x += par.vx;
//   par.y += par.vy;
   par.life  += -1;
   if(par.life<0){
     par.reset();
   }
 }
}
  
  var VALUE=1;

 function drawP(){
    var freqDomain = new Uint8Array(audio.analyser.frequencyBinCount);
        audio.analyser.getByteFrequencyData(freqDomain);
    //VALUE=freqDomain[127]/100;
   //draw();
   var value=1;
  if (audio.playing){
    //draw();
     for (var i = 0; i < audio.analyser.frequencyBinCount; i++){
    //   var value;
     //  P.push(new Particle);
       if (i < audio.analyser.frequencyBinCount) {
            value = freqDomain[i] /5;
         VALUE=value/3;
          } 
       context.strokeStyle='#00ee00';
       context.fillStyle='#000ee0'; 
       context.fillRect(i*3,0,1,value);
      draw();
     
     }
   
  }
  // draw();
}

  
  (function drawFrame(){
 window.requestAnimationFrame(drawFrame,canvas);
 context.clearRect(0,0,canvas.width,canvas.height);  
 //drawScreen();
 drawP();
// function drawScreen(){
//context.beginPath();
 //context.strokeStyle='#00ee00';
// context.fillStyle='#000ee0';
// context.lineWidth=2;
 //context.fillRect(100,100,400,50);
//draw();
//}
    

}());
  
} 




</script>
</html>
